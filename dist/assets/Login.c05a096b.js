import{_ as v,a as m,A as n,r as f,o as t,c as i,b as a,d as b,e as p,f as P,w as L,g as u,h as l,v as d,F as c,i as N,j as F,t as w}from"./index.75d0bc81.js";import{L as U}from"./Loader.07a570fa.js";const V={name:"login",components:{Loader:U},data:()=>({loading:!0,loadingLoginForm:!1,loadingRegisterForm:!1,hasToken:!1,name:"",registerErrors:[],registered:!1,registeredPlayerName:"",loginData:{username:"",password:""},registerData:{username:"",password:"",confirmPassword:""}}),methods:{register(){this.loadingRegisterForm=!0,this.registerErrors=[];const s={username:this.registerData.username,password:this.registerData.password,confirmPassword:this.registerData.confirmPassword};m.post(n.getApiUrl()+"register",s).then(e=>{console.log(e.data);const g=e.data.errors;if(g){g.forEach(h=>{this.registerErrors.push(h)});return}console.log("successfully registered"),this.registered=!0}).catch(e=>{console.log(e)}).finally(()=>{this.loadingRegisterForm=!1})},registerPlayerName(){const s={username:this.registerData.username,password:this.registerData.password,playerName:this.registeredPlayerName};m.post(n.getApiUrl()+"register_name",s).then(e=>{console.log(e.data),this.loginData.username=this.registerData.username,this.loginData.password=this.registerData.password,this.login()}).catch(e=>{console.log(e)})},async login(){this.loadingLoginForm=!0;const s={username:this.loginData.username,password:this.loginData.password},e=await n.login(s);console.log(e),e&&Object.hasOwn(e,"token")&&Object.hasOwn(e,"refresh_token")&&(this.hasToken=!0,await this.axiosPlayerData(!1),this.$router.go({name:"games"})),this.loadingLoginForm=!1},logout(){n.logout(),this.$router.go({name:"login"})},async axiosPlayerData(s){m.get(n.getApiUrl()+"player/data",n.getAuthHeader()).then(e=>{console.log(e.data),this.name=e.data.name}).catch(async e=>{console.log(e),e.response.status===401&&!s&&await n.refreshUser()&&await this.axiosPlayerData(!0)}).finally(()=>{this.loading=!1})}},created(){const s=n.getTokens();if(console.log(s),s&&Object.hasOwn(s,"token")&&Object.hasOwn(s,"refresh_token")){this.hasToken=!0,this.axiosPlayerData(!1);return}this.loading=!1}},O=a("div",{class:"main-header"},[a("h1",{class:"main-title"},"Login")],-1),C={class:"main-inner"},E={key:1},R={key:0},T={class:"mt-3"},j=F(" Not you? "),A={key:1,class:"row"},B={class:"col-md-6"},S=a("button",{type:"submit",class:"btn"},"Login",-1),_={class:"col-md-6"},M={key:0,class:"color-danger"},z=a("button",{type:"submit",class:"btn"},"Register",-1),H={key:2,class:"d-flex gap-3 flex-column justify-content-center align-items-center",style:{padding:"200px"}};function q(s,e,g,h,G,o){const y=f("Loader"),D=f("router-link");return t(),i(c,null,[O,a("div",C,[s.loading||s.loadingLoginForm||s.loadingRegisterForm?(t(),b(y,{key:0})):p("",!0),s.loading?p("",!0):(t(),i("div",E,[s.hasToken?(t(),i("div",R,[P(D,{to:{name:"home"},class:"btn"},{default:L(()=>[a("span",null,"Continue as "+w(s.name),1)]),_:1}),a("div",T,[j,a("a",{href:"#",onClick:e[0]||(e[0]=u((...r)=>o.logout&&o.logout(...r),["prevent"]))},"Logout")])])):s.registered?(t(),i("div",H,[l(a("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>s.registeredPlayerName=r),style:{"font-size":"30px"}},null,512),[[d,s.registeredPlayerName]]),a("a",{href:"#",class:"btn btn--danger",onClick:e[9]||(e[9]=u((...r)=>o.registerPlayerName&&o.registerPlayerName(...r),["prevent"]))},"Confirm name & login")])):(t(),i("div",A,[a("div",B,[a("form",{onSubmit:e[3]||(e[3]=u((...r)=>o.login&&o.login(...r),["prevent"]))},[a("p",null,[l(a("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.loginData.username=r),placeholder:"username"},null,512),[[d,s.loginData.username]])]),a("p",null,[l(a("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.loginData.password=r),placeholder:"password",type:"password"},null,512),[[d,s.loginData.password]])]),S],32)]),a("div",_,[a("form",{onSubmit:e[7]||(e[7]=u((...r)=>o.register&&o.register(...r),["prevent"]))},[a("p",null,[l(a("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>s.registerData.username=r),placeholder:"username",minlength:"4"},null,512),[[d,s.registerData.username]])]),a("p",null,[l(a("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s.registerData.password=r),placeholder:"password",type:"password",minlength:"4"},null,512),[[d,s.registerData.password]])]),a("p",null,[l(a("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>s.registerData.confirmPassword=r),placeholder:"confirm password",type:"password",minlength:"4"},null,512),[[d,s.registerData.confirmPassword]])]),s.registerErrors?(t(),i("div",M,[(t(!0),i(c,null,N(s.registerErrors,(r,k)=>(t(),i("div",{key:k},w(r.message),1))),128))])):p("",!0),z],32)])]))]))])],64)}const K=v(V,[["render",q]]);export{K as default};
